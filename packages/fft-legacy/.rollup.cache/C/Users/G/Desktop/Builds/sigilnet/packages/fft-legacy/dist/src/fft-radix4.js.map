{"version":3,"file":"fft-radix4.js","sourceRoot":"","sources":["../../src/fft-radix4.ts"],"names":[],"mappings":"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","sourcesContent":["// fft-radix4.ts\nimport { Complex } from './types/types';\nimport { FFTImplementation } from './fft-adapter';\n\nexport class Radix4FFT implements FFTImplementation {\n  private readonly size: number;\n  private readonly table: Float64Array;\n  private readonly bitrev: Uint16Array;\n\n  constructor(size: number) {\n    if (size <= 1 || (size & (size - 1)) !== 0) {\n      throw new Error(\"FFT size must be a power of two and greater than 1\");\n    }\n\n    this.size = size;\n    this.table = this.computeTwiddleTable(size);\n    this.bitrev = this.computeBitReversal(size);\n  }\n\n  private computeTwiddleTable(size: number): Float64Array {\n    const table = new Float64Array(size * 2);\n    for (let i = 0; i < size; i++) {\n      const angle = (2 * Math.PI * i) / size;\n      table[2 * i] = Math.cos(angle);\n      table[2 * i + 1] = -Math.sin(angle);\n    }\n    return table;\n  }\n\n  private computeBitReversal(size: number): Uint16Array {\n    const bits = Math.log2(size);\n    const rev = new Uint16Array(size);\n    for (let i = 0; i < size; i++) {\n      let x = i;\n      let y = 0;\n      for (let j = 0; j < bits; j++) {\n        y = (y << 1) | (x & 1);\n        x >>>= 1;\n      }\n      rev[i] = y;\n    }\n    return rev;\n  }\n\n  /**\n   * Performs an in-place FFT on a complex array.\n   * Format: [real0, imag0, real1, imag1, ...]\n   */\n  forward(buffer: Float64Array): void {\n    const N = this.size;\n    const rev = this.bitrev;\n\n    // Bit-reversal reordering\n    for (let i = 0; i < N; i++) {\n      const j = rev[i];\n      if (i < j) {\n        const ri = 2 * i, rj = 2 * j;\n        const tmpR = buffer[ri], tmpI = buffer[ri + 1];\n        buffer[ri] = buffer[rj]; buffer[ri + 1] = buffer[rj + 1];\n        buffer[rj] = tmpR; buffer[rj + 1] = tmpI;\n      }\n    }\n\n    // Cooleyâ€“Tukey decimation-in-time radix-2 FFT\n    for (let len = 2; len <= N; len <<= 1) {\n      const ang = -2 * Math.PI / len;\n      const wlenR = Math.cos(ang), wlenI = Math.sin(ang);\n\n      for (let i = 0; i < N; i += len) {\n        let wr = 1, wi = 0;\n        for (let j = 0; j < len / 2; j++) {\n          const uR = buffer[2 * (i + j)];\n          const uI = buffer[2 * (i + j) + 1];\n          const vR = buffer[2 * (i + j + len / 2)];\n          const vI = buffer[2 * (i + j + len / 2) + 1];\n\n          const tR = wr * vR - wi * vI;\n          const tI = wr * vI + wi * vR;\n\n          buffer[2 * (i + j)] = uR + tR;\n          buffer[2 * (i + j) + 1] = uI + tI;\n          buffer[2 * (i + j + len / 2)] = uR - tR;\n          buffer[2 * (i + j + len / 2) + 1] = uI - tI;\n\n          const nextWR = wr * wlenR - wi * wlenI;\n          wi = wr * wlenI + wi * wlenR;\n          wr = nextWR;\n        }\n      }\n    }\n  }\n}\n"]}