(function(m,I){typeof exports=="object"&&typeof module<"u"?I(exports):typeof define=="function"&&define.amd?define(["exports"],I):(m=typeof globalThis<"u"?globalThis:m||self,I(m.fft_legacy={}))})(this,(function(m){"use strict";function I(e,t){return[e[0]+t[0],e[1]+t[1]]}function dt(e,t){return[e[0]-t[0],e[1]-t[1]]}function lt(e,t){return[e[0]*t[0]-e[1]*t[1],e[0]*t[1]+e[1]*t[0]]}function _t(e){return Math.sqrt(e[0]**2+e[1]**2)}const O={};function tt(e,t){const s=-2*Math.PI*(e/t);return O[t]??={},O[t][e]??=[Math.cos(s),Math.sin(s)],O[t][e]}function Tt(e){return e.map(_t).slice(0,e.length/2)}function Ft(e,t){const s=t/e.length;return e.slice(0,e.length/2).map((r,n)=>n*s)}const wt=Object.freeze(Object.defineProperty({__proto__:null,exponent:tt,fftFreq:Ft,fftMag:Tt},Symbol.toStringTag,{value:"Module"}));function gt(e){if(e<1)return 1;let t=1;for(;t<e;)t<<=1;return t}class mt{size;vector;table;_csize;_width;_bitrev;_out=null;_data=null;_inv=0;data;freq=0;constructor(t){let s=t;t instanceof Float64Array||(s=Float64Array.from(t)),s.length<=2?this.size=gt(t.length):(this._csize=this.size<<1,this.size=s.length),this.data=new Float64Array(this._csize);for(let o=0;o<t.length;o++)this.data[o<<1]=t[o];this.table=new Float64Array(this._csize);for(let o=0;o<this._csize;o+=2){const i=Math.PI*(o>>1)/s.length;this.table[o]=Math.cos(i),this.table[o+1]=-Math.sin(i)}let r=0;for(let o=1;o<s.length;o<<=1)r++;this._width=r%2===0?r-1:r;const n=1<<this._width;this._bitrev=new Uint32Array(n);for(let o=0;o<n;o++){let i=0;for(let c=0;c<this._width;c+=2){const a=this._width-c-2;i|=(o>>>c&3)<<a}this._bitrev[o]=i}}setInverse(t){this._inv=t?1:0}fromComplexArray(t,s){const r=s||new Float64Array(t.length>>>1);for(let n=0;n<t.length;n+=2)r[n>>>1]=t[n];return r}createComplexArray(){return new Float64Array(this._csize)}bitReverse(t,s){let r=0;for(let n=0;n<s;n++)r=r<<1|t>>>n&1;return r}toComplexArray(t,s){const r=s||this.createComplexArray();for(let n=0;n<r.length;n+=2)r[n]=t[n>>>1]??0,r[n+1]=0;return r}completeSpectrum(t){const s=this._csize,r=s>>>1;for(let n=2;n<r;n+=2)t[s-n]=t[n],t[s-n+1]=-t[n+1];return t}transform(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s,this._inv=0,this._transform4(),this._out=null,this._data=null;const r=1/Math.sqrt(this.size);for(let n=0;n<t.length;n++)t[n]*=r}realTransform(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s instanceof Float64Array?s:Float64Array.from(s),this._inv=0,this._realTransform4(),this._out=null,this._data=null;const r=1/Math.sqrt(this.size);for(let n=0;n<t.length;n++)t[n]*=r}inverseTransform(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s,this._inv=1,this._transform4();const r=1/Math.sqrt(this.size);for(let n=0;n<t.length;n++)t[n]=this._out[n]*r;this._out=null,this._data=null}_transform4(){const t=this._out;if(!t)throw new Error("'out' buffer is null");const s=this._csize;let n=1<<this._width,o=s/n<<1,i,c;const a=this._bitrev;if(o===4)for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleTransform2(i,h,n)}else for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleTransform4(i,h,n)}const l=this._inv?-1:1;let u=this.table;for(n>>=2;n>=2;n>>=2){o=s/n<<1;const h=o>>>2;for(i=0;i<s;i+=o){const F=i+h;for(let g=i,f=0;g<F;g+=2,f+=n){const d=g,_=d+h,T=_+h,w=T+h,A=t[d],C=t[d+1],M=t[_],b=t[_+1],y=t[T],v=t[T+1],B=t[w],p=t[w+1],z=A,D=C,S=u[f],R=l*u[f+1],q=M*S-b*R,E=M*R+b*S,X=u[2*f],k=l*u[2*f+1],N=y*X-v*k,U=y*k+v*X,G=u[3*f],H=l*u[3*f+1],J=B*G-p*H,K=B*H+p*G,Q=z+N,P=D+U,L=z-N,V=D-U,W=q+J,j=E+K,x=l*(q-J),Y=l*(E-K),$=Q+W,nt=P+j,st=Q-W,ot=P-j,rt=L+Y,et=V-x,it=L-Y,ct=V+x;t[d]=$,t[d+1]=nt,t[_]=rt,t[_+1]=et,t[T]=st,t[T+1]=ot,t[w]=it,t[w+1]=ct}}}}_singleTransform2(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=o[s],c=o[s+1],a=o[s+r],l=o[s+r+1],u=i+a,h=c+l,F=i-a,g=c-l;n[t]=u,n[t+1]=h,n[t+2]=F,n[t+3]=g}_singleTransform4(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=this._inv?-1:1,c=r*2,a=r*3,l=o[s],u=o[s+1],h=o[s+r],F=o[s+r+1],g=o[s+c],f=o[s+c+1],d=o[s+a],_=o[s+a+1],T=l+g,w=u+f,A=l-g,C=u-f,M=h+d,b=F+_,y=i*(h-d),v=i*(F-_),B=T+M,p=w+b,z=A+v,D=C-y,S=T-M,R=w-b,q=A-v,E=C+y;n[t]=B,n[t+1]=p,n[t+2]=z,n[t+3]=D,n[t+4]=S,n[t+5]=R,n[t+6]=q,n[t+7]=E}_realTransform4(){const t=this._out;if(!t)throw new Error("'data' buffer is null");const s=this._csize;let n=1<<this._width,o=s/n<<1,i,c;const a=this._bitrev;if(o===4)for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleRealTransform2(i,h>>>1,n>>>1)}else for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleRealTransform4(i,h>>>1,n>>>1)}const l=this._inv?-1:1,u=this.table;for(n>>=2;n>=2;n>>=2){o=s/n<<1;const h=o>>>1,F=h>>>1,g=F>>>1;for(i=0;i<s;i+=o)for(let f=0,d=0;f<=g;f+=2,d+=n){const _=i+f,T=_+F,w=T+F,A=w+F,C=t[_],M=t[_+1],b=t[T],y=t[T+1],v=t[w],B=t[w+1],p=t[A],z=t[A+1],D=C,S=M,R=u[d],q=l*u[d+1],E=b*R-y*q,X=b*q+y*R,k=u[2*d],N=l*u[2*d+1],U=v*k-B*N,G=v*N+B*k,H=u[3*d],J=l*u[3*d+1],K=p*H-z*J,Q=p*J+z*H,P=D+U,L=S+G,V=D-U,W=S-G,j=E+K,x=X+Q,Y=l*(E-K),$=l*(X-Q),nt=P+j,st=L+x,ot=V+$,rt=W-Y;if(t[_]=nt,t[_+1]=st,t[T]=ot,t[T+1]=rt,f===0){const Et=P-j,It=L-x;t[w]=Et,t[w+1]=It;continue}if(f===g)continue;const et=V,it=-W,ct=P,yt=-L,vt=-l*$,Bt=-l*Y,pt=-l*x,zt=-l*j,Dt=et+vt,St=it+Bt,Rt=ct+zt,qt=yt-pt,ut=i+F-f,ft=i+h-f;t[ut]=Dt,t[ut+1]=St,t[ft]=Rt,t[ft+1]=qt}}}_singleRealTransform2(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=o[s],c=o[s+r],a=i+c,l=i-c;n[t]=a,n[t+1]=0,n[t+2]=l,n[t+3]=0}_singleRealTransform4(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=this._inv?-1:1,c=r*2,a=r*3,l=o[s],u=o[s+r],h=o[s+c],F=o[s+a],g=l+h,f=l-h,d=u+F,_=i*(u-F),T=g+d,w=f,A=-_,C=g-d,M=f,b=_;n[t]=T,n[t+1]=0,n[t+2]=w,n[t+3]=A,n[t+4]=C,n[t+5]=0,n[t+6]=M,n[t+7]=b}}function Z(e){const t=e.length,s=[];if(t===1){const c=e[0];return[Array.isArray(c)?[c[0],c[1]]:[Number(c),0]]}const r=(c,a)=>a%2===0,n=(c,a)=>a%2===1,o=Z(e.filter(r)),i=Z(e.filter(n));for(let c=0;c<t/2;c++){const a=o[c],l=lt(tt(c,t),i[c]);s[c]=I(a,l),s[c+t/2]=dt(a,l)}return s}function bt(e){const t=new Float64Array(e.length);for(let s=0;s<e.length;s++){const[r,n]=e[s];t[s]=Math.hypot(r,n)}return t}function At(e){const t=e.length;if(t===0)return new Float64Array(0);if((t&t-1)===0)return e;let r=1;for(;r<t;)r<<=1;const n=new Float64Array(r);return n.set(e),n}function at(e){const t=At(e),s=Z(Array.from(t));return bt(s)}function Mt(e){const t=at(e),s=t.reduce((r,n)=>r+(Number.isFinite(n)?n:0),0);return s>0?t[0]/s:0}function ht(e){const t=e.length,s=[];for(let r=0;r<t;r++){let n=[0,0];for(let o=0;o<t;o++){const i=typeof e[o]=="number"?[e[o],0]:e[o],c=tt(r*o,t);n=I(n,lt(i,c))}s[r]=n}return s}function Ct(e){const t=e.map(([r,n])=>[n,r]),s=ht(t);return s.map(([r,n])=>[n/s.length,r/s.length])}m.FFT=mt,m.deriveCoherence=Mt,m.dft=ht,m.fftFunc=Z,m.forwardMagnitudes=at,m.ifft=Ct,m.util=wt,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})}));
