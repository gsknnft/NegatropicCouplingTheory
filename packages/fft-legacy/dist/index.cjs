"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function lt(e,t){return[e[0]+t[0],e[1]+t[1]]}function Ct(e,t){return[e[0]-t[0],e[1]-t[1]]}function at(e,t){return[e[0]*t[0]-e[1]*t[1],e[0]*t[1]+e[1]*t[0]]}function vt(e){return Math.sqrt(e[0]**2+e[1]**2)}const rt={};function et(e,t){const s=-2*Math.PI*(e/t);return rt[t]??={},rt[t][e]??=[Math.cos(s),Math.sin(s)],rt[t][e]}function yt(e){return e.map(vt).slice(0,e.length/2)}function Bt(e,t){const s=t/e.length;return e.slice(0,e.length/2).map((r,n)=>n*s)}const pt=Object.freeze(Object.defineProperty({__proto__:null,exponent:et,fftFreq:Bt,fftMag:yt},Symbol.toStringTag,{value:"Module"}));function zt(e){if(e<1)return 1;let t=1;for(;t<e;)t<<=1;return t}class Dt{size;vector;table;_csize;_width;_bitrev;_out=null;_data=null;_inv=0;data;freq=0;constructor(t){let s=t;t instanceof Float64Array||(s=Float64Array.from(t)),s.length<=2?this.size=zt(t.length):(this._csize=this.size<<1,this.size=s.length),this.data=new Float64Array(this._csize);for(let o=0;o<t.length;o++)this.data[o<<1]=t[o];this.table=new Float64Array(this._csize);for(let o=0;o<this._csize;o+=2){const i=Math.PI*(o>>1)/s.length;this.table[o]=Math.cos(i),this.table[o+1]=-Math.sin(i)}let r=0;for(let o=1;o<s.length;o<<=1)r++;this._width=r%2===0?r-1:r;const n=1<<this._width;this._bitrev=new Uint32Array(n);for(let o=0;o<n;o++){let i=0;for(let c=0;c<this._width;c+=2){const a=this._width-c-2;i|=(o>>>c&3)<<a}this._bitrev[o]=i}}setInverse(t){this._inv=t?1:0}fromComplexArray(t,s){const r=s||new Float64Array(t.length>>>1);for(let n=0;n<t.length;n+=2)r[n>>>1]=t[n];return r}createComplexArray(){return new Float64Array(this._csize)}bitReverse(t,s){let r=0;for(let n=0;n<s;n++)r=r<<1|t>>>n&1;return r}toComplexArray(t,s){const r=s||this.createComplexArray();for(let n=0;n<r.length;n+=2)r[n]=t[n>>>1]??0,r[n+1]=0;return r}completeSpectrum(t){const s=this._csize,r=s>>>1;for(let n=2;n<r;n+=2)t[s-n]=t[n],t[s-n+1]=-t[n+1];return t}transform(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s,this._inv=0,this._transform4(),this._out=null,this._data=null;const r=1/Math.sqrt(this.size);for(let n=0;n<t.length;n++)t[n]*=r}realTransform(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s instanceof Float64Array?s:Float64Array.from(s),this._inv=0,this._realTransform4(),this._out=null,this._data=null;const r=1/Math.sqrt(this.size);for(let n=0;n<t.length;n++)t[n]*=r}inverseTransform(t,s){if(t===s)throw new Error("Input and output buffers must be different");this._out=t,this._data=s,this._inv=1,this._transform4();const r=1/Math.sqrt(this.size);for(let n=0;n<t.length;n++)t[n]=this._out[n]*r;this._out=null,this._data=null}_transform4(){const t=this._out;if(!t)throw new Error("'out' buffer is null");const s=this._csize;let n=1<<this._width,o=s/n<<1,i,c;const a=this._bitrev;if(o===4)for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleTransform2(i,h,n)}else for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleTransform4(i,h,n)}const l=this._inv?-1:1;let u=this.table;for(n>>=2;n>=2;n>>=2){o=s/n<<1;const h=o>>>2;for(i=0;i<s;i+=o){const F=i+h;for(let g=i,f=0;g<F;g+=2,f+=n){const _=g,d=_+h,T=d+h,w=T+h,b=t[_],M=t[_+1],A=t[d],m=t[d+1],C=t[T],v=t[T+1],y=t[w],B=t[w+1],p=b,z=M,D=u[f],S=l*u[f+1],R=A*D-m*S,q=A*S+m*D,L=u[2*f],j=l*u[2*f+1],X=C*L-v*j,k=C*j+v*L,N=u[3*f],U=l*u[3*f+1],G=y*N-B*U,H=y*U+B*N,J=p+X,E=z+k,I=p-X,K=z-k,Q=R+G,x=q+H,P=l*(R-G),V=l*(q-H),W=J+Q,Z=E+x,$=J-Q,O=E-x,tt=I+V,nt=K-P,st=I-V,ot=K+P;t[_]=W,t[_+1]=Z,t[d]=tt,t[d+1]=nt,t[T]=$,t[T+1]=O,t[w]=st,t[w+1]=ot}}}}_singleTransform2(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=o[s],c=o[s+1],a=o[s+r],l=o[s+r+1],u=i+a,h=c+l,F=i-a,g=c-l;n[t]=u,n[t+1]=h,n[t+2]=F,n[t+3]=g}_singleTransform4(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=this._inv?-1:1,c=r*2,a=r*3,l=o[s],u=o[s+1],h=o[s+r],F=o[s+r+1],g=o[s+c],f=o[s+c+1],_=o[s+a],d=o[s+a+1],T=l+g,w=u+f,b=l-g,M=u-f,A=h+_,m=F+d,C=i*(h-_),v=i*(F-d),y=T+A,B=w+m,p=b+v,z=M-C,D=T-A,S=w-m,R=b-v,q=M+C;n[t]=y,n[t+1]=B,n[t+2]=p,n[t+3]=z,n[t+4]=D,n[t+5]=S,n[t+6]=R,n[t+7]=q}_realTransform4(){const t=this._out;if(!t)throw new Error("'data' buffer is null");const s=this._csize;let n=1<<this._width,o=s/n<<1,i,c;const a=this._bitrev;if(o===4)for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleRealTransform2(i,h>>>1,n>>>1)}else for(i=0,c=0;i<s;i+=o,c++){const h=a[c];this._singleRealTransform4(i,h>>>1,n>>>1)}const l=this._inv?-1:1,u=this.table;for(n>>=2;n>=2;n>>=2){o=s/n<<1;const h=o>>>1,F=h>>>1,g=F>>>1;for(i=0;i<s;i+=o)for(let f=0,_=0;f<=g;f+=2,_+=n){const d=i+f,T=d+F,w=T+F,b=w+F,M=t[d],A=t[d+1],m=t[T],C=t[T+1],v=t[w],y=t[w+1],B=t[b],p=t[b+1],z=M,D=A,S=u[_],R=l*u[_+1],q=m*S-C*R,L=m*R+C*S,j=u[2*_],X=l*u[2*_+1],k=v*j-y*X,N=v*X+y*j,U=u[3*_],G=l*u[3*_+1],H=B*U-p*G,J=B*G+p*U,E=z+k,I=D+N,K=z-k,Q=D-N,x=q+H,P=L+J,V=l*(q-H),W=l*(L-J),Z=E+x,$=I+P,O=K+W,tt=Q-V;if(t[d]=Z,t[d+1]=$,t[T]=O,t[T+1]=tt,f===0){const At=E-x,Mt=I-P;t[w]=At,t[w+1]=Mt;continue}if(f===g)continue;const nt=K,st=-Q,ot=E,ft=-I,_t=-l*W,dt=-l*V,Tt=-l*P,Ft=-l*x,wt=nt+_t,gt=st+dt,mt=ot+Ft,bt=ft-Tt,it=i+F-f,ct=i+h-f;t[it]=wt,t[it+1]=gt,t[ct]=mt,t[ct+1]=bt}}}_singleRealTransform2(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=o[s],c=o[s+r],a=i+c,l=i-c;n[t]=a,n[t+1]=0,n[t+2]=l,n[t+3]=0}_singleRealTransform4(t,s,r){const n=this._out,o=this._data;if(!o||!n)throw new Error("'data' buffer is null");const i=this._inv?-1:1,c=r*2,a=r*3,l=o[s],u=o[s+r],h=o[s+c],F=o[s+a],g=l+h,f=l-h,_=u+F,d=i*(u-F),T=g+_,w=f,b=-d,M=g-_,A=f,m=d;n[t]=T,n[t+1]=0,n[t+2]=w,n[t+3]=b,n[t+4]=M,n[t+5]=0,n[t+6]=A,n[t+7]=m}}function Y(e){const t=e.length,s=[];if(t===1){const c=e[0];return[Array.isArray(c)?[c[0],c[1]]:[Number(c),0]]}const r=(c,a)=>a%2===0,n=(c,a)=>a%2===1,o=Y(e.filter(r)),i=Y(e.filter(n));for(let c=0;c<t/2;c++){const a=o[c],l=at(et(c,t),i[c]);s[c]=lt(a,l),s[c+t/2]=Ct(a,l)}return s}function St(e){const t=new Float64Array(e.length);for(let s=0;s<e.length;s++){const[r,n]=e[s];t[s]=Math.hypot(r,n)}return t}function Rt(e){const t=e.length;if(t===0)return new Float64Array(0);if((t&t-1)===0)return e;let r=1;for(;r<t;)r<<=1;const n=new Float64Array(r);return n.set(e),n}function ht(e){const t=Rt(e),s=Y(Array.from(t));return St(s)}function qt(e){const t=ht(e),s=t.reduce((r,n)=>r+(Number.isFinite(n)?n:0),0);return s>0?t[0]/s:0}function ut(e){const t=e.length,s=[];for(let r=0;r<t;r++){let n=[0,0];for(let o=0;o<t;o++){const i=typeof e[o]=="number"?[e[o],0]:e[o],c=et(r*o,t);n=lt(n,at(i,c))}s[r]=n}return s}function Et(e){const t=e.map(([r,n])=>[n,r]),s=ut(t);return s.map(([r,n])=>[n/s.length,r/s.length])}exports.FFT=Dt;exports.deriveCoherence=qt;exports.dft=ut;exports.fftFunc=Y;exports.forwardMagnitudes=ht;exports.ifft=Et;exports.util=pt;
